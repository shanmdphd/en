
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Handwriting recognition using R</title>
    
    <meta name="author" content="yixuan">

    <!-- Le HTML5 shim, for IE6-8 support of HTML elements -->
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <!-- Le styles -->
    <link href="/assets/themes/twitter/bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <link href="/assets/themes/twitter/css/style.css?body=1" rel="stylesheet" type="text/css" media="all">
    
    <!-- Web font -->
    <link href='http://fonts.googleapis.com/css?family=Open+Sans:700,400,400italic' rel='stylesheet' type='text/css'>
    
    <!-- Highlight support -->
    <link href="/assets/themes/twitter/bootstrap/css/highlight.css" rel="stylesheet">
    
    <!-- MathJax support -->
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        tex2jax: {
          inlineMath: [ ['$','$'], ["\\(","\\)"] ],
          processEscapes: true
        }
      });
    </script>
    <script type="text/x-mathjax-config">
        MathJax.Hub.Config({
          tex2jax: {
            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
          }
        });
    </script>
    <script type="text/x-mathjax-config">
        MathJax.Hub.Queue(function() {
            var all = MathJax.Hub.getAllJax(), i;
            for(i=0; i < all.length; i += 1) {
                all[i].SourceElement().parentNode.className += ' has-jax';
            }
        });
    </script>
    <script type="text/javascript"
       src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
    </script>
    
    

    <!-- Le fav and touch icons -->
  <!-- Update these with your own images
    <link rel="shortcut icon" href="images/favicon.ico">
    <link rel="apple-touch-icon" href="images/apple-touch-icon.png">
    <link rel="apple-touch-icon" sizes="72x72" href="images/apple-touch-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="114x114" href="images/apple-touch-icon-114x114.png">
  -->
  </head>

  <body>

    <div class="navbar">
      <div class="navbar-inner">
        <div class="container">
          <a class="brand" href="/">Yixuan's Blog</a>
          <ul class="nav">
            
            
            


  
    
      
      	
      	<li><a href="/pages.html">Pages</a></li>
      	
      
    
  
    
      
    
  
    
      
      	
      	<li><a href="/archive.html">Archive</a></li>
      	
      
    
  
    
      
      	
      	<li><a href="/categories.html">Categories</a></li>
      	
      
    
  
    
      
    
  
    
      
      	
      	<li><a href="/tags.html">Tags</a></li>
      	
      
    
  
    
      
    
  



          </ul>
        </div>
      </div>
    </div>

    <div class="container">

      <div class="content">
        
<div class="page-header">
  <h1>Handwriting recognition using R</h1>
</div>

<div class="row">
  <div class="span8">
    
<p>This title is a bit exaggerating since handwriting recognition is an advanced topic
in machine learning involving complex techniques and algorithms. In this blog I&rsquo;ll
show you a simple demo illustrating how to recognize a single number (0 ~ 9) using R.
The overall process is that, you draw a number in a graphics device in R using your mouse,
and then the program will &ldquo;guess&rdquo; what you have input. It is just for <strong>FUN</strong>.</p>

<p>There are two major problems in this number recognition problem, that
is, how to describe the trace of your handwriting, and how to classify
this trace to the give classes (0 ~ 9).</p>

<p>For the first question, we could first detect the motion of your mouse
in the graphics device, and then record the coordinates of you mouse
cursor at a sequence of time points. This could be done via the
<code>getGraphicsEvent()</code> function in <strong>grDevices</strong> package. For example, after I
drew a number 2 in the graphics window like below, the coordinates of
each point in the trace were assigned to a pair of variables <code>px</code> and <code>py</code>.</p>

<p><img src="http://yixuan.cos.name/en/wp-content/uploads/2011/12/Reco_trace.png" alt="Record trace" /></p>

<p>The scatterplot of <code>px</code> and <code>py</code> versus their orders in the trace is
shown below.</p>

<p><img src="http://yixuan.cos.name/en/wp-content/uploads/2011/12/Reco_points.png" alt="Record points" /></p>

<p>To be comparable among different traces, we normalize the Order to be
within (0, 1] (that is, transform 1, 2, &hellip;, n to 1/n, 2/n, &hellip;, 1).
Also, since this recording is discrete but the real trace should be
continuous, we use the <code>spline()</code> function to interpolate at unknown
points, resulting in the following figure.</p>

<p><img src="http://yixuan.cos.name/en/wp-content/uploads/2011/12/Reco_spline.png" alt="Record splines" /></p>

<p>The dots in the figure have normalized orders of 0.02, 0.04,
0.06, &hellip;, 1, at which the x and y coordinates are obtained by
interpolation. Therefore, we could use $r = (x, y)$ where
$x = (x_1, x_2, &hellip;, x_{50})&rsquo;$ and $y = (y_1, y_2, &hellip;, y_{50})&rsquo;$ to
represent the information of the number 2 I have drawn. Somewhat
confused by the operations above? Well, the idea behind this
normalization and interpolation is simple: use 50 &ldquo;uniformly
ordered&rdquo; points (I call them &ldquo;recording points&rdquo;) to represent the trace.</p>

<p>So it comes to the second question &ndash; given a trace, how to classify
it? Obviously we first need a training set, the recording points of
number 0 to number 9 generated as above. Then we&rsquo;ll compare the
given trace with each one in the training set and find out which
number resembles it most.</p>

<p>Several criteria could be used to measure the similarity, but some 
important rules should be considered. We still use $r = (x, y)$ to 
represent the recording points of a trace, and use $Sim(r_1, r_2)$ to 
stand for the similarity between two traces. Notice that this 
similarity should not be sensitive to the scale and location of 
traces. That is, if I draw a number in another location in the 
window, or in a larger or smaller size, the recognition should not be 
influenced. In mathematics, this could be expressed by</p>

<script type="math/tex; mode=display">Sim(r_1, r_2) = Sim(k_1 r_1 + b_1, k_2 r_2 + b_2)</script>

<p>where $k_1 &gt; 0$, $k_2 &gt; 0$, $b_1$, $b_2$ are real numbers.</p>

<p>In my code, I simply define the similarity as the sum of Pearson 
correlation coefficients of x and y, that is,</p>

<script type="math/tex; mode=display">Sim(r_1, r_2) = Corr(r_1.x, r_2.x) + Corr(r_1.y, r_2.y)</script>

<p>The whole source code is (note that I use 500 recording points 
instead of 50):</p>

<div class="highlight"><pre><code class="r">library<span class="p">(</span>grid<span class="p">);</span>
getData <span class="o">=</span> <span class="kr">function</span><span class="p">()</span>
<span class="p">{</span>
    <span class="kr">if</span><span class="p">(</span><span class="m">.</span>Platform<span class="p">$</span>OS.type <span class="o">==</span> <span class="s">&#39;windows&#39;</span><span class="p">)</span> x11<span class="p">()</span> <span class="kr">else</span> x11<span class="p">(</span>type <span class="o">=</span> <span class="s">&#39;Xlib&#39;</span><span class="p">);</span>
    pushViewport<span class="p">(</span>viewport<span class="p">());</span>
    grid.rect<span class="p">();</span>
    px <span class="o">=</span> <span class="kc">NULL</span><span class="p">;</span>
    py <span class="o">=</span> <span class="kc">NULL</span><span class="p">;</span>
    mousedown <span class="o">=</span> <span class="kr">function</span><span class="p">(</span>buttons<span class="p">,</span> x<span class="p">,</span> y<span class="p">)</span>
    <span class="p">{</span>
        <span class="kr">if</span><span class="p">(</span>length<span class="p">(</span>buttons<span class="p">)</span> <span class="o">&gt;</span> <span class="m">1</span> <span class="o">||</span> identical<span class="p">(</span>buttons<span class="p">,</span> <span class="m">2</span>L<span class="p">))</span>
            <span class="kr">return</span><span class="p">(</span>invisible<span class="p">(</span><span class="m">1</span><span class="p">));</span>
        eventEnv<span class="p">$</span>onMouseMove <span class="o">=</span> mousemove<span class="p">;</span>
        <span class="kc">NULL</span>
    <span class="p">}</span>
    mousemove <span class="o">=</span> <span class="kr">function</span><span class="p">(</span>buttons<span class="p">,</span> x<span class="p">,</span> y<span class="p">)</span>
    <span class="p">{</span>
        px <span class="o">&lt;&lt;-</span> c<span class="p">(</span>px<span class="p">,</span> x<span class="p">);</span>
        py <span class="o">&lt;&lt;-</span> c<span class="p">(</span>py<span class="p">,</span> y<span class="p">);</span>
        grid.points<span class="p">(</span>x<span class="p">,</span> y<span class="p">);</span>
        <span class="kc">NULL</span>
    <span class="p">}</span>
    mouseup <span class="o">=</span> <span class="kr">function</span><span class="p">(</span>buttons<span class="p">,</span> x<span class="p">,</span> y<span class="p">)</span> <span class="p">{</span>
        eventEnv<span class="p">$</span>onMouseMove <span class="o">=</span> <span class="kc">NULL</span><span class="p">;</span>
        <span class="kc">NULL</span>
    <span class="p">}</span>
    setGraphicsEventHandlers<span class="p">(</span>onMouseDown <span class="o">=</span> mousedown<span class="p">,</span>
                             onMouseUp <span class="o">=</span> mouseup<span class="p">);</span>
    eventEnv <span class="o">=</span> getGraphicsEventEnv<span class="p">();</span>
    cat<span class="p">(</span><span class="s">&quot;Click down left mouse button and drag to draw the number,</span>
<span class="s">        right click to finish.\n&quot;</span><span class="p">);</span>
    getGraphicsEvent<span class="p">();</span>
    dev.off<span class="p">();</span>
    s <span class="o">=</span> seq<span class="p">(</span><span class="m">0</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> length.out <span class="o">=</span> length<span class="p">(</span>px<span class="p">));</span>
    spx <span class="o">=</span> spline<span class="p">(</span>s<span class="p">,</span> px<span class="p">,</span> n <span class="o">=</span> <span class="m">500</span><span class="p">)$</span>y<span class="p">;</span>
    spy <span class="o">=</span> spline<span class="p">(</span>s<span class="p">,</span> py<span class="p">,</span> n <span class="o">=</span> <span class="m">500</span><span class="p">)$</span>y<span class="p">;</span>
    <span class="kr">return</span><span class="p">(</span>cbind<span class="p">(</span>spx<span class="p">,</span> spy<span class="p">));</span>
<span class="p">}</span>
traceCorr <span class="o">=</span> <span class="kr">function</span><span class="p">(</span>dat1<span class="p">,</span> dat2<span class="p">)</span>
<span class="p">{</span>
    cor<span class="p">(</span>dat1<span class="p">[,</span> <span class="m">1</span><span class="p">],</span> dat2<span class="p">[,</span> <span class="m">1</span><span class="p">])</span> <span class="o">+</span> cor<span class="p">(</span>dat1<span class="p">[,</span> <span class="m">2</span><span class="p">],</span> dat2<span class="p">[,</span> <span class="m">2</span><span class="p">]);</span>
<span class="p">}</span>

<span class="c1"># Please set the proper path of this file.</span>
load<span class="p">(</span><span class="s">&quot;train.RData&quot;</span><span class="p">);</span>
guess <span class="o">=</span> <span class="kr">function</span><span class="p">(</span>verbose <span class="o">=</span> <span class="kc">FALSE</span><span class="p">)</span>
<span class="p">{</span>
    test <span class="o">=</span> getData<span class="p">();</span>
    coefs <span class="o">=</span> sapply<span class="p">(</span>recogTrain<span class="p">,</span> traceCorr<span class="p">,</span> dat2 <span class="o">=</span> test<span class="p">);</span>
    num <span class="o">=</span> which.max<span class="p">(</span>coefs<span class="p">);</span>
    <span class="kr">if</span><span class="p">(</span>num <span class="o">==</span> <span class="m">10</span><span class="p">)</span> num <span class="o">=</span> <span class="m">0</span><span class="p">;</span>
    <span class="kr">if</span><span class="p">(</span>verbose<span class="p">)</span> print<span class="p">(</span>coefs<span class="p">);</span>
    cat<span class="p">(</span><span class="s">&quot;I guess what you have input is &quot;</span><span class="p">,</span> num<span class="p">,</span> <span class="s">&quot;.\n&quot;</span><span class="p">,</span> sep <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="p">);</span>
<span class="p">}</span>
guess<span class="p">();</span>
</code></pre>
</div>

<p>To run the code, you must load the &ldquo;training set&rdquo;, the file 
<code>train.RData</code>, into R using the <code>load()</code> function, and then call
<code>guess()</code> to play with it.</p>

<p>Have fun!</p>


    <hr>
    <div class="pagination">
      <ul>
      
        <li class="prev"><a href="/2011/10/windows-binary-of-rmysql" title="Windows binary of RMySQL">&larr; Previous</a></li>
      
        <li><a href="/archive.html">Archive</a></li>
      
        <li class="next"><a href="/2011/12/jekyll-introduction" title="Jekyll Introduction">Next &rarr;</a></li>
      
      </ul>
    </div>
    <hr>
    


  <div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_developer = 1;
    var disqus_shortname = 'jekyllbootstrap'; // required: replace example with your forum shortname
    
    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a>




  </div>
  
  <div class="span4">
    <h4>Published</h4>
    <div class="date"><span>18 December 2011</span></div>

  
    <h4>Tags</h4>
    <ul class="tag_box">
    
    


  
     
    	<li><a href="/tags.html#correlation-ref">correlation <span>1</span></a></li>
     
    	<li><a href="/tags.html#similarity-ref">similarity <span>1</span></a></li>
     
    	<li><a href="/tags.html#handwriting recognition-ref">handwriting recognition <span>1</span></a></li>
     
    	<li><a href="/tags.html#meachine learning-ref">meachine learning <span>1</span></a></li>
     
    	<li><a href="/tags.html#R-ref">R <span>2</span></a></li>
    
  



    </ul>
    
  </div>
</div>


      </div>

      <footer>
        <p>&copy; yixuan 2012 
          with help from <a href="http://jekyllbootstrap.com" target="_blank" title="The Definitive Jekyll Blogging Framework">Jekyll Bootstrap</a>
          and <a href="http://twitter.github.com/bootstrap/" target="_blank">Twitter Bootstrap</a>
        </p>
      </footer>

    </div> <!-- /container -->

    
  </body>
</html>

